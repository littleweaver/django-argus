{% extends "argus/__base.html" %}

{% block grouplink %}<a href="{{ group.get_absolute_url }}">{{ group.name|default:group.slug }}</a>{% endblock grouplink %}

{% block content %}
	<h1><a href="{{ group.get_absolute_url }}">{{ group.name|default:group.slug }}</a></h1>

	<p><a href="{% url 'argus_group_update' slug=group.slug %}">Edit group settings</a></p>

	{% if group.password %}<p><a href="{% url 'argus_group_logout' %}">Logout</a></p>{% endif %}

	<p><a href="{% url 'argus_payment_create' group_slug=group.slug %}">Record a payment to another member</a></p>
	<p><a href="{% url 'argus_even_create' group_slug=group.slug %}">Record an evenly-split expense</a></p>
	<p><a href="{% url 'argus_manual_create' group_slug=group.slug %}">Record an unenvenly-split expense</a></p>

	<h2>Members <small><a href="{% url 'argus_member_create' group_slug=group.slug %}">Add member</a></small></h2>
	{% with members=group.members.all %}
		{% if members %}
			<ul>
				{% for member in members %}
					<li><a href="{{ member.get_absolute_url }}">{{ member.name }}</a>: {{ member.balance }}</li>
				{% endfor %}
			</ul>
		{% else %}
			<p>No members found.</p>
		{% endif %}
	{% endwith %}

	<h2>Recipients <small><a href="{% url 'argus_recipient_create' group_slug=group.slug %}">Add recipient</a></small></h2>
	{% with recipients=group.recipients.all %}
		{% if recipients %}
			<ul>
				{% for recipient in recipients %}
					<li><a href="{{ recipient.get_absolute_url }}">{{ recipient.name }}</a></li>
				{% endfor %}
			</ul>
		{% else %}
			<p>No recipients found.</p>
		{% endif %}
	{% endwith %}

	{% if group.use_categories %}
		<h2>Categories <small><a href="{% url 'argus_category_create' group_slug=group.slug %}">Add category</a></small></h2>
		{% with categories=group.categories.all %}
			{% if categories %}
				<ul>
					{% for category in categories %}
						<li><a href="{{ category.get_absolute_url }}">{{ category.name }}</a></li>
					{% endfor %}
				</ul>
			{% else %}
				<p>No categories found.</p>
			{% endif %}
		{% endwith %}
	{% endif %}

	<table class="table">
		<thead>
			<tr>
				<th>Paid at</th>
				<th>Paid by</th>
				<th>Paid to</th>
				<th>Memo</th>
				<th>Cost ({{ group.currency }})</th>
				{% if group.use_categories %}
					<th>Category</th>
				{% endif %}
				{% for member in group.members.all %}
					<th>{{ member.name }} ({{ member.balance }})</th>
				{% endfor %}
			</tr>
		</thead>
		<tbody>
			{% for expense in recent_expenses|slice:":10" %}
				<tr>
					<td>{{ expense.paid_at|date:"Y-m-d H:i:s" }}</td>
					<td><a href="{{ expense.member.get_absolute_url }}">{{ expense.member.name }}</a></td>
					<td><a href="{{ expense.recipient.get_absolute_url }}">{{ expense.recipient.name }}</a></td>
					<td>{{ expense.memo }}</td>
					<td>{{ expense.cost }}</td>
					{% if group.use_categories %}
						<td><a href="{{ expense.category.get_absolute_url }}">{{ expense.category.name }}</a></td>
					{% endif %}
					{% for member in group.members.all %}
						{% for share in expense.shares.all %}
							{% if share.member_id == member.pk %}
								<td>{{ share.amount }} ({{ share.percentage }})</td>
							{% endif %}
						{% endfor %}
					{% endfor %}
				</tr>
			{% endfor %}
		</tbody>
	</table>
{% endblock %}
